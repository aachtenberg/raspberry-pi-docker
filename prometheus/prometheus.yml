global:
  scrape_interval: 15s
  evaluation_interval: 15s

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  - job_name: 'raspberry-pi'
    static_configs:
      - targets: ['node-exporter:9100']
        labels:
          instance: 'raspberry-pi'
          host: '192.168.0.167'

  - job_name: 'raspberry-pi2'
    static_configs:
      - targets: ['192.168.0.147:9100']
        labels:
          instance: 'raspberry-pi2'
          host: '192.168.0.147'

  - job_name: 'docker'
    static_configs:
      - targets: ['cadvisor:8080']
        labels:
          instance: 'raspberry-pi'
          host: '192.168.0.167'
    metric_relabel_configs:
      # Use container name as container_name for easier queries
      - source_labels: [name]
        target_label: container_name
      # Use Docker Compose project name if available
      - source_labels: [container_label_com_docker_compose_project]
        target_label: project
      # Drop all the verbose container_label_* labels to reduce cardinality
      - action: labeldrop
        regex: 'container_label_.*'

  - job_name: 'docker-pi2'
    static_configs:
      - targets: ['192.168.0.147:8080']
        labels:
          instance: 'raspberry-pi2'
          host: '192.168.0.147'
    metric_relabel_configs:
      # Use container name as container_name for easier queries
      - source_labels: [name]
        target_label: container_name
      # Use Docker Compose project name if available
      - source_labels: [container_label_com_docker_compose_project]
        target_label: project
      # Drop all the verbose container_label_* labels to reduce cardinality
      - action: labeldrop
        regex: 'container_label_.*'

  # InfluxDB v2 - DISABLED (migrated to v3)
  # - job_name: 'influxdb'
  #   static_configs:
  #     - targets: ['influxdb:8086']
  #       labels:
  #         instance: 'raspberry-pi'
  #         service: 'influxdb-v2'
  #   metrics_path: '/metrics'
  #   scrape_interval: 15s

  - job_name: 'influxdb3'
    static_configs:
      - targets: ['192.168.0.167:8181']
        labels:
          instance: 'raspberry-pi'
          service: 'influxdb-v3'
    metrics_path: '/metrics'
    scrape_interval: 15s
    fallback_scrape_protocol: PrometheusText0.0.4
    authorization:
      type: Bearer
      credentials_file: /etc/prometheus/influxdb3_token

  - job_name: 'telegraf'
    static_configs:
      - targets: ['localhost:9273']
        labels:
          instance: 'raspberry-pi'
          service: 'telegraf'
    scrape_interval: 15s

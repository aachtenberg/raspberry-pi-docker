name: Secrets Check

on:
  push:
    # Run on any branch push
    branches:
      - '**'
  pull_request:
    # Run on all PRs targeting any branch
    branches:
      - '**'

jobs:
  check-secrets:
    runs-on: ubuntu-latest
    name: Check for exposed secrets

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Fail if .env is committed
        run: |
          if git ls-files --error-unmatch .env >/dev/null 2>&1; then
            echo "❌ .env is tracked in git. Remove it before pushing."
            exit 1
          fi
          echo "✅ .env not tracked"

      - name: Scan repository with gitleaks
        uses: gitleaks/gitleaks-action@v2
        with:
          args: --no-git --redact --verbose
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
